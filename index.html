<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>iTHRIVE.</title>
  <!-- GOOGLE FONT -->
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap"
    rel="stylesheet"
  />
  <!-- PWA: theming -->
  <meta name="theme-color" content="#202c61" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="iTHRIVE" />
  <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
  <style>
    /* ==== GLOBAL ==== */
    body { margin: 0; background: #f4f6fa; font-family: 'Montserrat', Arial, sans-serif; color: #202c61; }
    .layout { min-height: 100vh; }
    .page { display: none; padding: 20px; max-width: 600px; margin: 30px auto; background: #fff; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); }
    .page.active { display: block; }
    h2, p { text-align: center; }
    /* … (all your existing CSS unchanged) … */
    /* ==== CAMPUS EMOJIS ==== */
    #page-campus .emoji-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 12px;
      margin-top: 20px;
    }
    #page-campus .emoji-tile {
      border-radius: 12px;
      padding: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: auto;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    #page-campus .emoji {
      font-size: 6rem;
      line-height: 1;
    }
    /* … (rest of your CSS) … */
  </style>
</head>
<body>
  <div class="layout">
    <!-- HEADER, PAGES 1–4 markup unchanged -->
    <!-- PAGE 1: SPLASH -->
    <!-- PAGE 2: CAMPUS PICKER -->
    <!-- PAGE 3: TEACHER SELECT -->
    <!-- PAGE 4: THRIVE CHECK QUESTIONS -->
  </div>

  <!-- ────────── APP LOGIC ────────── -->
  <script>
    // 1) Navigate between pages
    function goTo(id) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      if (id === 'page-teacher') showTeachers();
      if (id === 'page-questions') {
        document.querySelector('.thanks-msg').style.display = 'none';
        document.querySelectorAll('.emoji-btn.selected')
                .forEach(b => b.classList.remove('selected'));
      }
    }
    document.getElementById('splashBtn').onclick = () => goTo('page-campus');
    function scrollToCampus() {
      document.getElementById('campusCircles')
              .scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
</div>  <!-- end of .layout -->

<!-- ────────── APP LOGIC ────────── -->
<script>
  // 1) Navigate between pages
  function goTo(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if (id === 'page-teacher') showTeachers();
    if (id === 'page-questions') {
      document.querySelector('.thanks-msg').style.display = 'none';
      document.querySelectorAll('.emoji-btn.selected')
              .forEach(b => b.classList.remove('selected'));
    }
  }
  document.getElementById('splashBtn').onclick = () => goTo('page-campus');
  function scrollToCampus() {
    document.getElementById('campusCircles')
      .scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  // 2) Show teachers
  function showTeachers() {
    const grid = document.getElementById('teacher-list');
    grid.innerHTML = '';
    teacherMap[window.selectedCampus].forEach(name => {
      const btn = document.createElement('button');
      btn.onclick = () => goTo('page-questions');
      btn.innerHTML = `<img src="${teacherPhotos[name]}" alt="${name}"/><div>${name}</div>`;
      grid.appendChild(btn);
    });
  }
  document.querySelectorAll('.campus-thumb').forEach(el => {
    el.onclick = () => {
      document.querySelectorAll('.campus-thumb')
        .forEach(x => x.classList.remove('selected'));
      el.classList.add('selected');
      window.selectedCampus = el.dataset.campus;
      goTo('page-teacher');
    };
  });

  // 3) Language toggle
  document.getElementById('langSelect').addEventListener('change', e => {
    document.querySelectorAll('.question').forEach(el => {
      el.textContent = el.dataset[e.target.value];
    });
  });
  document.getElementById('langSelect').dispatchEvent(new Event('change'));

  // 4) Capture THRIVE ratings
  const answers = {};
  document.querySelectorAll('.emoji-row').forEach(row => {
    row.addEventListener('click', e => {
      if (!e.target.matches('.emoji-btn')) return;
      row.querySelectorAll('.emoji-btn').forEach(b => b.classList.remove('selected'));
      e.target.classList.add('selected');
      const code = row.closest('.question-block').dataset.code;
      answers[code] = parseInt(e.target.dataset.rating, 10);
    });
  });

  // 5) Submit handler & save to Firestore
  async function saveVibeCheck() {
    const user = firebase.auth().currentUser;
    if (!user) {
      alert('Still signing you in—please wait a moment and try again.');
      return;
    }
    const payload = {
      uid:       user.uid,
      campus:    window.selectedCampus,
      teacher:   window.selectedTeacher,
      language:  document.getElementById('langSelect').value,
      recommend: parseInt(document.getElementById('stars').value, 10),
      timestamp: firebase.firestore.FieldValue.serverTimestamp(),
      ...answers
    };
    try {
      const docRef = await db.collection('vibeChecks').add(payload);
      console.log('Saved vibe check:', docRef.id, payload);
    } catch (err) {
      console.error('Error saving vibe check:', err);
      alert('Couldn’t record your feedback—please try again.');
    }
  }
  document.getElementById('vibe-form').addEventListener('submit', e => {
    e.preventDefault();
    if (Object.keys(answers).length < 6) {
      alert('Please tap an emoji for all six questions before submitting.');
      return;
    }
    saveVibeCheck();
    document.querySelector('.thanks-msg').style.display = 'block';
  });
</script>
<!-- ────────────────────────────────── -->

<!-- ─── FIREBASE COMPAT SDKs & INIT ─── -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey:            "AIzaSyDd6uaoLk-6BDL7b4NggCYQz5NErUzFFWk",
    authDomain:        "ithriveincas.firebaseapp.com",
    projectId:         "ithriveincas",
    storageBucket:     "ithriveincas.firebasestorage.app",
    messagingSenderId: "873460211632",
    appId:             "1:873460211632:web:015b40f2e4f08829458075",
    measurementId:     "G-8QMJE6H7H2"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  firebase.auth().onAuthStateChanged(user => {
    if (!user) {
      firebase.auth().signInAnonymously().catch(console.error);
    } else {
      console.log('Signed in as', user.uid);
    }
  });
</script>

</body>
</html>

  
