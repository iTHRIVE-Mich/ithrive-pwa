<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>iTHRIVE.</title>
  <!-- GOOGLE FONT -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet"/>
  <!-- PWA: manifest & theming -->
  <meta name="theme-color" content="#202c61" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="iTHRIVE" />
  <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
  <style>
    /* ==== GLOBAL & PAGE STYLES ==== */
    body { margin: 0; background: #f4f6fa; font-family: 'Montserrat', Arial, sans-serif; color: #202c61; }
    .layout { min-height: 100vh; }
    .page { display: none; padding: 20px; max-width: 600px; margin: 30px auto; background: #fff; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); }
    .page.active { display: block; }
    h2, p { text-align: center; }
    header { background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); padding: 10px 20px; display: flex; align-items: center; }
    header img { height: 60px; margin-right: 18px; cursor: pointer; }
    .slogan-container { flex: 1; text-align: center; }
    .slogan { display: flex; justify-content: center; gap: .5em; font-size: 2rem; font-weight: 700; }
    .slogan .iwant { color: #196f38; } .slogan .ican { color: #ffd400; }
    .slogan .ibelong { color: #202c61; } .slogan .ithrive { color: #ffd400; }
    .subline { margin-top: 4px; font-size: 1rem; color: #0d47a1; font-weight: 600; }
    #main-nav { display:flex; gap:1rem; padding:1rem; border-bottom:1px solid #ddd; }
    #main-nav button { flex:none; padding:0.5rem 1rem; border:none; border-radius:0.375rem; cursor:pointer; }
    /* ‚Ä¶ (all your existing CSS for splash, campus picker, teacher select, vibe questions, leaderboard) ‚Ä¶ */

    /* ‚Äî‚Äî FEEDBACK WIDGET STYLES ‚Äî‚Äî */
    #feedback-widget .recommend-container { margin-bottom: 1rem; }
    #feedback-widget label { display: block; font-weight: bold; margin-bottom: 0.5rem; }
    #feedback-widget select {
      width: 100%; padding: 0.5rem; font-size: 1rem;
      border: 1px solid #ccc; border-radius: 0.375rem;
    }
    #feedback-widget .submit-row {
      display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1rem;
    }
    #feedback-widget .submit-row button {
      flex: none; padding: 0.75rem 1.5rem; font-size: 1rem;
      border-radius: 0.375rem; border: 2px solid transparent;
      background: #2f855a; color: white; cursor: pointer;
    }
    #feedback-widget .submit-row button.back {
      background: white; color: #2d3748; border-color: #2d3748;
    }
    #feedback-widget .thanks-msg {
      display: none; margin-top: 1.5rem; padding: 1rem;
      text-align: center; font-size: 1.1rem;
      background: #f0fff4; border: 1px solid #c6f6d5; border-radius: 0.375rem;
    }
    /* Force widget clickability */
    #feedback-widget, #feedback-widget .submit-row, #feedback-widget .submit-row button {
      position: relative !important;
      z-index: 9999 !important;
      pointer-events: auto !important;
      cursor: pointer !important;
    }
  </style>
</head>
<body>
  <div class="layout">
    <!-- HEADER -->
    <header>
      <img src="https://raw.githubusercontent.com/iTHRIVE-Mich/ithrive-pwa/main/ithrive logo.png"
           alt="Logo" onclick="goTo('page-splash')" />
      <div class="slogan-container">
        <div class="slogan">
          <span class="iwant">I WANT.</span>
          <span class="ican">I CAN.</span>
          <span class="ibelong">I BELONG.</span>
          <span class="ithrive">I THRIVE.</span>
        </div>
        <div class="subline">
          No Names. One Tap. One Emoji for a Thriving Class.
        </div>
      </div>
    </header>

    <!-- NAV BAR -->
    <div id="main-nav">
      <button type="button" onclick="goTo('page-questions')">Thrive</button>
      <button type="button" onclick="goTo('page-leaderboard')">Leaderboard</button>
    </div>

    <!-- PAGE 1: SPLASH -->
    <section id="page-splash" class="page active">
      <div class="splash-container">
        <img src="https://raw.githubusercontent.com/iTHRIVE-Mich/ithrive-pwa/main/cover.png" alt="Welcome" />
      </div>
      <button id="splashBtn">Tap when you're ready.</button>
    </section>

    <!-- PAGE 2: CAMPUS PICKER -->
    <section id="page-campus" class="page">
      <button class="campus-header-btn" type="button" onclick="scrollToCampus()">
        Select Campus
      </button>
      <div id="campusCircles" class="campus-circles">
        <div class="campus-thumb" data-campus="Main">
          <img src="https://raw.githubusercontent.com/iTHRIVE-Mich/ithrive-pwa/main/Main.png" alt="Main"/>
          <span>Main</span>
        </div>
        <div class="campus-thumb" data-campus="South">
          <img src="https://raw.githubusercontent.com/iTHRIVE-Mich/ithrive-pwa/main/South.png" alt="South"/>
          <span>South</span>
        </div>
        <div class="campus-thumb" data-campus="San Jose">
          <img src="https://raw.githubusercontent.com/iTHRIVE-Mich/ithrive-pwa/main/San%20Jose.png" alt="San Jose"/>
          <span>San Jose</span>
        </div>
      </div>
    </section>

    <!-- PAGE 3: TEACHER SELECT -->
    <section id="page-teacher" class="page">
      <button class="btn back" onclick="goTo('page-campus')">Back</button>
      <div id="teacher-list" class="grid"></div>
    </section>

    <!-- PAGE 4: VIBE QUESTIONS -->
    <section id="page-questions" class="page">
      <div class="top-row">
        <div class="thrive-banner">
          Teach. Help. Real-Life Application. Interaction. Voice. Engage.
        </div>
        <div class="lang-toggle">
          <select id="langSelect">
            <option value="tl">üíö</option>
            <option value="en">ü§Ø</option>
          </select>
        </div>
      </div>

      <div class="emoji-guide">
        <div class="tile" style="background:#2E67A7;color:white;">
          <div class="emoji">üî•</div>
          <div class="emoji-text">Always: Consistent. Solid!</div>
        </div>
        <div class="tile" style="background:#FFD400;color:#202c61;">
          <div class="emoji">üòé</div>
          <div class="emoji-text">Often: Chill and Steady.</div>
        </div>
        <div class="tile" style="background:#428A33;color:white;">
          <div class="emoji">üòê</div>
          <div class="emoji-text">Sometimes: Saks lang.</div>
        </div>
        <div class="tile" style="background:#737273;color:white;">
          <div class="emoji">ü´†</div>
          <div class="emoji-text">Rarely: Dimasyado ramdam.</div>
        </div>
      </div>

      <form id="vibe-form">
        <!-- Question blocks T, H, R, I, V, E (each with .question-block and .emoji-row) -->
        <!-- ‚Ä¶ your existing 6 blocks ‚Ä¶ -->
      </form>

      <!-- Feedback Widget for Hype Level -->
      <div id="feedback-widget">
        <div id="feedbackForm">
          <div class="recommend-container">
            <label for="stars">
              <b>How much would you hype Ma'am/Sir to a friend?</b>
            </label>
            <select id="stars" name="hypeLevel" required>
              <option value="" disabled selected>Choose rating</option>
              <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
              <option value="3">‚≠ê‚≠ê‚≠ê</option>
              <option value="2">‚≠ê‚≠ê</option>
              <option value="1">‚≠ê</option>
            </select>
          </div>
          <div class="submit-row">
            <button type="button" class="back" onclick="goTo('page-campus')">Back</button>
            <button type="button" id="feedbackSubmitBtn">Submit</button>
          </div>
        </div>
        <div class="thanks-msg">
          üå± You‚Äôre helping your teacher help you thrive. Salamat! üå±
        </div>
      </div>
    </section>

    <!-- LEADERBOARD PAGE -->
    <section id="page-leaderboard" class="page">
      <h2>üåü Leaderboard: Top 5 Teachers</h2>
      <ol id="leaderboard-list"></ol>
    </section>
  </div>

  <script>
    // NAVIGATION & INTERACTIONS (goTo, scrollToCampus, showTeachers, language toggle, capture emoji ratings‚Ä¶)
    // ‚Äî keep this exactly as in your original file ‚Äî
  </script>

  <!-- ‚îÄ‚îÄ‚îÄ FIRESTORE INTEGRATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getAnalytics }  from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      serverTimestamp,
      Timestamp,
      query,
      where
    } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

    // Your Firebase config (from Console)
    const firebaseConfig = {
      apiKey: "AIzaSyDd6uaoLk-6BDL7b4NggCYQz5NErUzFFWk",
      authDomain: "ithriveincas.firebaseapp.com",
      projectId: "ithriveincas",
      storageBucket: "ithriveincas.appspot.com",
      messagingSenderId: "873460211632",
      appId: "1:873460211632:web:015b40f2e4f08829458075",
      measurementId: "G-8QMJE6H7H2"
    };
    const app = initializeApp(firebaseConfig);
    getAnalytics(app);
    const db  = getFirestore(app);

    // Submission handler for anonymous vibe‚Äêchecks
    document.addEventListener("DOMContentLoaded", () => {
      const submitBtn = document.getElementById("feedbackSubmitBtn");
      const formDiv   = document.getElementById("feedbackForm");
      const thanks    = document.querySelector("#feedback-widget .thanks-msg");
      const selectEl  = document.getElementById("stars");

      submitBtn.addEventListener("click", async () => {
        // ensure all 6 emojis tapped
        if (Object.keys(answers).length < 6) {
          alert("‚ùó Please tap an emoji for all six questions before submitting.");
          return;
        }
        // ensure hype‚Äêlevel chosen
        if (!selectEl.value) {
          alert("‚ùó Please select how much you'd hype your teacher.");
          return;
        }

        // write anonymous doc
        await addDoc(collection(db, "vibeChecks"), {
          teacherName:   window.selectedTeacher,
          teacherCampus: window.selectedCampus,
          answers,                             // { T:4, H:3, R:2, I:4, V:3, E:2 }
          hypeLevel:     parseInt(selectEl.value, 10),
          ts:            serverTimestamp()
        });

        // show thanks
        formDiv.style.display = "none";
        thanks.style.display  = "block";
        thanks.scrollIntoView({ behavior: "smooth" });
      });
    });

    // Leaderboard logic (14‚Äêday window, aggregate 1‚òÖ & 4‚òÖ, sort, render top 5)
    async function renderLeaderboard() {
      const startDate = new Date(/* your window start */);
      const endDate   = new Date(startDate);
      endDate.setDate(endDate.getDate() + 14);

      const q = query(
        collection(db, "vibeChecks"),
        where("ts", ">=", Timestamp.fromDate(startDate)),
        where("ts", "<",  Timestamp.fromDate(endDate))
      );
      const snap = await getDocs(q);

      const agg = {};
      snap.forEach(doc => {
        const { teacherName, teacherCampus, answers } = doc.data();
        const extreme = Object.values(answers).filter(v => v===1 || v===4);
        if (!extreme.length) return;
        const sum = extreme.reduce((s,v)=>s+v, 0), cnt = extreme.length;
        agg[teacherName] = agg[teacherName] || { sum:0, cnt:0, campus:teacherCampus };
        agg[teacherName].sum += sum;
        agg[teacherName].cnt += cnt;
      });

      const arr = Object.entries(agg).map(([name, { sum, cnt, campus }]) => ({
        name, campus, avg: sum / cnt
      }));
      arr.sort((a,b)=>b.avg - a.avg);
      const top5 = arr.slice(0,5);

      const ol = document.getElementById("leaderboard-list");
      ol.innerHTML = "";
      top5.forEach(({name, campus}, i) => {
        const li = document.createElement("li");
        li.innerHTML = `
          <img src="https://raw.githubusercontent.com/iTHRIVE-Mich/ithrive-pwa/main/${encodeURIComponent(name)}.png" alt="${name}" class="leader-img"/>
          <div class="leader-info">
            <div class="leader-name">${name}</div>
            <div class="leader-campus">${campus}</div>
          </div>
          <div class="leader-rank">${i+1}</div>
        `;
        ol.appendChild(li);
      });
    }
    document.addEventListener("DOMContentLoaded", renderLeaderboard);
  </script>
</body>
</html>
